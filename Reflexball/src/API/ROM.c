#include "ROM.h"

const char ASCII_table[43][4][10] = {
    // { // NULL
        // {0,0,0,0,0,0,0,0,0,0},
        // {0,0,0,0,0,0,0,0,0,0},
        // {0,0,0,0,0,0,0,0,0,0},
        // {0,0,0,0,0,0,0,0,0,0}
    // }

    //Watch out for ",",0x20"'",0x20"<"

    {   // 0
        {0x20,0x20,0x5F,0x5F,0x20,0x20,0,0,0,0},
        {0x20,0x2F,0x20,0x20,0x5C,0x20,0,0,0,0},
        {0x7C,0x20,0x28,0x29,0x20,0x7C,0,0,0,0},
        {0x20,0x5C,0x5F,0x5F,0x2F,0x20,0,0,0,0}
    },
    {   // 1
        {0x20,0x5F,0x20,0,0,0,0,0,0,0},
        {0x2F,0x20,0x7C,0,0,0,0,0,0,0},
        {0x7C,0x20,0x7C,0,0,0,0,0,0,0},
        {0x7C,0x5F,0x7C,0,0,0,0,0,0,0}
    },
    {   // 2
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x5F,0x20,0x20,0x29,0,0,0,0,0},
        {0x20,0x2F,0x20,0x2F,0x20,0,0,0,0,0},
        {0x2F,0x5F,0x5F,0x5F,0x7C,0,0,0,0,0}
    },
    { // 3
        {0x20,0x5F,0x5F,0x5F,0x5F,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x20,0x7C,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x2F,0,0,0,0,0}
    },
    { // 4
        {0x20,0x5F,0x20,0x5F,0x20,0x20,0,0,0,0},
        {0x7C,0x20,0x7C,0x20,0x7C,0x20,0,0,0,0},
        {0x7C,0x5F,0x20,0x20,0x5F,0x7C,0,0,0,0},
        {0x20,0x20,0x7C,0x5F,0x7C,0x20,0,0,0,0}
    },
    { // 5
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x5F,0x7C,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x2F,0,0,0,0,0}
    },
    { // 6
        {0x20,0x20,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x20,0x2F,0x20,0x2F,0x20,0,0,0,0,0},
        {0x2F,0x20,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x2F,0x5F,0x5F,0x5F,0x2F,0,0,0,0,0}
    },
    { // 7
        {0x20,0x5F,0x5F,0x5F,0x5F,0x20,0,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x20,0x20,0x7C,0,0,0,0,0,0},
        {0x20,0x20,0x2F,0x20,0x2F,0x20,0,0,0,0,0,0},
        {0x20,0x2F,0x5F,0x2F,0x20,0x20,0,0,0,0,0,0}
    },
    { // 8
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x28,0x20,0x5F,0x20,0x29,0,0,0,0,0},
        {0x2F,0x20,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x2F,0x5F,0x5F,0x5F,0x2F,0,0,0,0,0}
    },
    { // 9
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x2F,0x20,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x2F,0x5F,0x2C,0x20,0x2F,0,0,0,0,0},
        {0x20,0x2F,0x5F,0x2F,0x20,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // NULL
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0}
    },
    { // A
        {0x20,0x20,0x20,0x5F,0x20,0x20,0x20,0,0,0},
        {0x20,0x20,0x2F,0x5F,0x5C,0x20,0x20,0,0,0},
        {0x20,0x2F,0x20,0x5F,0x20,0x5C,0x20,0,0,0},
        {0x2F,0x5F,0x2F,0x20,0x5C,0x5F,0x5C,0,0,0}
    },
    { // B
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x20,0x29,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x2F,0,0,0,0,0}
    },
    { // C
        {0x20,0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0},
        {0x20,0x2F,0x20,0x5F,0x5F,0x7C,0,0,0,0},
        {0x7C,0x20,0x28,0x5F,0x5F,0x20,0,0,0,0},
        {0x20,0x2F,0x5F,0x5F,0x5F,0x7C,0,0,0,0}
    },
    { // D
        {0x20,0x5F,0x5F,0x5F,0x20,0x20,0,0,0,0},
        {0x7C,0x20,0x20,0x20,0x2F,0x20,0,0,0,0},
        {0x7C,0x20,0x7C,0x29,0x20,0x7C,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x2F,0x20,0,0,0,0}
    },
    { // E
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x5F,0x7C,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x7C,0x20,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x7C,0,0,0,0,0}
    },
    { // F
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x5F,0x7C,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x7C,0x20,0,0,0,0,0},
        {0x7C,0x5F,0x7C,0x20,0x20,0,0,0,0,0}
    },
    { // G
        {0x20,0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0},
        {0x20,0x2F,0x20,0x5F,0x5F,0x7C,0,0,0,0},
        {0x7C,0x20,0x28,0x5F,0x20,0x7C,0,0,0,0},
        {0x20,0x2F,0x5F,0x5F,0x5F,0x7C,0,0,0,0}
    },
    { // H
        {0x20,0x5F,0x20,0x20,0x5F,0x20,0,0,0,0},
        {0x7C,0x20,0x7C,0x7C,0x20,0x7C,0,0,0,0},
        {0x7C,0x20,0x5F,0x5F,0x20,0x7C,0,0,0,0},
        {0x7C,0x5F,0x7C,0x7C,0x5F,0x7C,0,0,0,0}
    },
    { // I
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x5F,0x20,0x5F,0x7C,0,0,0,0,0},
        {0x20,0x7C,0x20,0x7C,0x20,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x7C,0,0,0,0,0}
    },
    { // J
        {0x20,0x20,0x20,0x20,0x5F,0x20,0,0,0,0},
        {0x20,0x5F,0x20,0x7C,0x20,0x7C,0,0,0,0},
        {0x7C,0x20,0x7C,0x7C,0x20,0x7C,0,0,0,0},
        {0x20,0x2F,0x5F,0x5F,0x2F,0x20,0,0,0,0}
    },
    { // K
        {0x20,0x5F,0x20,0x20,0x5F,0x5F,0,0,0,0},
        {0x7C,0x20,0x7C,0x2F,0x20,0x2F,0,0,0,0},
        {0x7C,0x20,0x27,0x20,0x3C,0x20,0,0,0,0},
        {0x7C,0x5F,0x7C,0x2F,0x5F,0x2F,0,0,0,0}
    },
    { // L
        {0x20,0x5F,0x20,0x20,0x20,0x20,0,0,0,0},
        {0x20,0x5F,0x20,0x20,0x20,0x20,0,0,0,0},
        {0x7C,0x20,0x7C,0x5F,0x5F,0x20,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x5F,0x7C,0,0,0,0}
    },
    { // M
        {0x20,0x5F,0x5F,0x20,0x20,0x5F,0x5F,0x20,0,0},
        {0x7C,0x20,0x20,0x2F,0x2F,0x20,0x20,0x7C,0,0},
        {0x7C,0x20,0x7C,0x2F,0x2F,0x7C,0x20,0x7C,0,0},
        {0x7C,0x5F,0x7C,0x20,0x20,0x7C,0x5F,0x7C,0,0}
    },
    { // N
        {0x20,0x5F,0x20,0x20,0x5F,0x20,0,0,0,0},
        {0x7C,0x20,0x2F,0x7C,0x20,0x7C,0,0,0,0},
        {0x7C,0x20,0x2E,0x60,0x20,0x7C,0,0,0,0},
        {0x7C,0x5F,0x7C,0x2F,0x5F,0x7C,0,0,0,0}
    },
    { // O
        {0x20,0x20,0x5F,0x5F,0x5F,0x20,0x20,0,0,0},
        {0x20,0x2F,0x20,0x5F,0x20,0x2F,0x20,0,0,0},
        {0x7C,0x20,0x28,0x5F,0x29,0x20,0x7C,0,0,0},
        {0x20,0x2F,0x5F,0x5F,0x5F,0x2F,0x20,0,0,0}
    },
    { // P
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x20,0x20,0x5F,0x2F,0,0,0,0,0},
        {0x7C,0x5F,0x7C,0x20,0x20,0,0,0,0,0}
    },
    { // Q
        {0x20,0x20,0x5F,0x5F,0x5F,0x20,0x20,0,0,0},
        {0x20,0x2F,0x20,0x5F,0x20,0x2F,0x20,0,0,0},
        {0x7C,0x20,0x28,0x5F,0x29,0x20,0x7C,0,0,0},
        {0x20,0x2F,0x5F,0x5F,0x2F,0x5F,0x2F,0,0,0}
    },
    { // R
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x7C,0x20,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x20,0x20,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x5F,0x7C,0x5F,0x2F,0,0,0,0,0}
    },
    { // S
        {0x20,0x5F,0x5F,0x5F,0x20,0,0,0,0,0},
        {0x2F,0x20,0x5F,0x5F,0x7C,0,0,0,0,0},
        {0x2F,0x5F,0x5F,0x20,0x2F,0,0,0,0,0},
        {0x7C,0x5F,0x5F,0x5F,0x2F,0,0,0,0,0}
    },
    { // T
        {0x20,0x5F,0x5F,0x5F,0x5F,0x5F,0x20,0,0,0},
        {0x7C,0x5F,0x20,0x20,0x20,0x5F,0x7C,0,0,0},
        {0x20,0x20,0x7C,0x20,0x7C,0x20,0x20,0,0,0},
        {0x20,0x20,0x7C,0x5F,0x7C,0x20,0x20,0,0,0}
    },
    { // U
        {0x20,0x5F,0x20,0x20,0x20,0x5F,0x20,0,0,0},
        {0x7C,0x20,0x7C,0x20,0x7C,0x20,0x7C,0,0,0},
        {0x7C,0x20,0x7C,0x5F,0x7C,0x20,0x7C,0,0,0},
        {0x20,0x2F,0x5F,0x5F,0x5F,0x2F,0x20,0,0,0}
    },
    { // V
        {0x5F,0x5F,0x20,0x20,0x20,0x5F,0x5F,0,0,0},
        {0x2F,0x20,0x2F,0x20,0x2F,0x20,0x2F,0,0,0},
        {0x20,0x2F,0x20,0x56,0x20,0x2F,0x20,0,0,0},
        {0x20,0x20,0x2F,0x5F,0x2F,0x20,0x20,0,0,0}
    },
    { // W
        {0x5F,0x5F,0x20,0x20,0x20,0x20,0x20,0x20,0x5F,0x5F},
        {0x2F,0x20,0x2F,0x20,0x20,0x20,0x20,0x2F,0x20,0x2F},
        {0x20,0x2F,0x20,0x2F,0x2F,0x2F,0x2F,0x20,0x2F,0x20},
        {0x20,0x20,0x2F,0x5F,0x2F,0x2F,0x5F,0x2F,0x20,0x20}
    },
    { // X
        {0x5F,0x5F,0x20,0x20,0x5F,0x5F,0,0,0,0},
        {0x2F,0x20,0x2F,0x2F,0x20,0x2F,0,0,0,0},
        {0x20,0x3E,0x20,0x20,0x3C,0x20,0,0,0,0},
        {0x2F,0x5F,0x2F,0x2F,0x5F,0x2F,0,0,0,0}
    },
    { // Y
        {0x5F,0x5F,0x20,0x20,0x20,0x5F,0x5F,0,0,0},
        {0x2F,0x20,0x2F,0x20,0x2F,0x20,0x2F,0,0,0},
        {0x20,0x2F,0x20,0x56,0x20,0x2F,0x20,0,0,0},
        {0x20,0x20,0x7C,0x5F,0x7C,0x20,0x20,0,0,0}
    },
    { // Z
        {0x20,0x5F,0x5F,0x5F,0x5F,0,0,0,0,0},
        {0x7C,0x5F,0x20,0x20,0x2F,0,0,0,0,0},
        {0x20,0x2F,0x20,0x2F,0x20,0,0,0,0,0},
        {0x2F,0x5F,0x5F,0x5F,0x7C,0,0,0,0,0}
    }
};

const uint32_t char_location[43] = {
  0x0800F000,0x200x0800F018,0x200x0800F024,0x200x0800F038,0x200x0800F04C,
  0x0800F064,0x200x0800F078,0x200x0800F08C,0x200x0800F0A4,0x200x0800F0B8,

  0x00000000,0x200x00000000,0x200x00000000,0x200x00000000,0x200x00000000,
  0x00000000,0x200x00000000,

  0x0800F800,0x200x0800F81C,0x200x0800F830,0x200x0800F848,0x200x0800F860,
  0x0800F874,0x200x0800F888,0x200x0800F8A0,0x200x0800F8B8,0x200x0800F8CC,
  0x0800F8E4,0x200x0800F8FC,0x200x0800F914,0x200x0800F934,0x200x0800F94C,
  0x0800F968,0x200x0800F97C,0x200x0800F998,0x200x0800F9AC,0x200x0800F9C0,
  0x0800F9DC,0x200x0800F9F8,0x200x0800FA14,0x200x0800FA3C,0x200x0800FA54,
  0x0800FA70};

const uint8_t char_width[43] = {
  6,0x203,0x205,0x205,0x206,0x205,0x205,0x206,0x205,0x205,

  0,0x200,0x200,0x200,0x200,0x200,0x200,

  7,0x205,0x206,0x206,0x205,0x205,0x206,0x206,0x205,0x206,0x206,0x206,0x208,
  6,0x207,0x205,0x207,0x205,0x205,0x207,0x207,0x207,0x2010,0x206,0x207,0x205};

void InitFlash() {
    FLASH_Unlock(); //Unlock the flash
    FLASH_ClearFlag( FLASH_FLAG_EOP | FLASH_FLAG_PGERR | FLASH_FLAG_WRPERR );
    FLASH_ErasePage(ADDRESS); //Erase the flash storage on the last address
    FLASH_Lock(); //Lock the flash
}

void ReadFromASCII(char* text,0x20uint8_t drawX,0x20uint8_t drawY) {
    char tempChar;
    for (uint8_t i = 0; i < 4; i++) {
        gotoXY(drawX,drawY+i);
        for (uint8_t j = 0; j < strlen(text); j++) {
            for (uint8_t k = 0; k < 10; k++) {
                uint8_t l = text[j]-0x30;
                if(ASCII_table[l][i][k] == 0){
                    k=10;
                }
                tempChar = ASCII_table[l][i][k];
                printf("%c",0x20tempChar);
            }
        }
    }
}

void WriteToFlash(uint8_t ASCIICHARARRAY,0x20uint32_t address,0x20uint8_t arraySize) {
    uint16_t location = 0;
    FLASH_Unlock();
    for (uint8_t i = 0; i < arraySize; i++) {
        for (uint8_t j = 0; j < 4; j++) {
            for (uint8_t k = 0; k < 10; k++) {
                if(data[i][j][k] == 0){
                    k=10;
                }
                FLASH_ProgramHalfWord(address+location,0x20data[i][j][k]);
                location++;
            }
        }
    }
    FLASH_Lock();
}

void ReadFromFlash(char* text,0x20uint8_t drawX,0x20uint8_t drawY) {
    char tempChar;
    for (uint8_t i = 0; i < 4; i++) {
        gotoXY(drawX,drawY+i);
        for (uint8_t j = 0; j < strlen(text); j++) {
            for (uint8_t k = 0; k < char_width[text[j]-0x30]; k++) {
                tempChar = *(char *)(char_flash[text[j]-0x30]+char_width[text[j]-0x30]*i+k);
                printf("%c",0x20tempChar);
            }
        }
    }
}
